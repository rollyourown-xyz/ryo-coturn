{{'{{'}} if keyExists "service/coturn/{{ host_id }}/listening-port" {{'}}'}}
listening-port={{'{{'}} key "service/coturn/{{ host_id }}/listening-port" {{'}}'}}
{{'{{'}} else {{'}}'}}
listening-port=3478
{{'{{'}} end {{'}}'}}

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/tls-listening-port" {{'}}'}}
tls-listening-port={{'{{'}} key "service/coturn/{{ host_id }}/tls-listening-port" {{'}}'}}
{{'{{'}} else {{'}}'}}
tls-listening-port=5349
{{'{{'}} end {{'}}'}}

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/ip-addr-host" {{'}}'}}
listening-ip={{ lxd_host_network_part }}.{{'{{'}} key "service/coturn/{{ host_id }}/ip-addr-host" {{'}}'}}
{{'{{'}} end {{'}}'}}

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/ip-addr-host" {{'}}'}}
relay-ip={{ lxd_host_network_part }}.{{'{{'}} key "service/coturn/{{ host_id }}/ip-addr-host" {{'}}'}}
{{'{{'}} end {{'}}'}}

external-ip={{ host_public_ip }}

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/min-port" {{'}}'}}
min-port={{'{{'}} key "service/coturn/{{ host_id }}/min-port" {{'}}'}}
{{'{{'}} else {{'}}'}}
min-port=50000
{{'{{'}} end {{'}}'}}

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/max-port" {{'}}'}}
max-port={{'{{'}} key "service/coturn/{{ host_id }}/max-port" {{'}}'}}
{{'{{'}} else {{'}}'}}
max-port=51000
{{'{{'}} end {{'}}'}}

lt-cred-mech
use-auth-secret
static-auth-secret={{ coturn_static_auth_secret }}

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/turn-domain" {{'}}'}}
realm={{'{{'}} key "service/coturn/{{ host_id }}/turn-domain" {{'}}'}}
{{'{{'}} end {{'}}'}}

no-tcp-relay
cert=/etc/turn/tls/{{ host_id }}.cert.pem
pkey=/etc/turn/tls/{{ host_id }}.key.pem
no-loopback-peers
no-multicast-peers
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=172.16.0.0-172.31.255.255

{{'{{'}} if keyExists "service/coturn/{{ host_id }}/ip-addr-host" {{'}}'}}
allowed-peer-ip={{ lxd_host_network_part }}.{{'{{'}} key "service/coturn/{{ host_id }}/ip-addr-host" {{'}}'}}
{{'{{'}} end {{'}}'}}

user-quota=0
total-quota=0
no-loopback-peers
no-multicast-peers
userdb=/var/turn/turndb
syslog
proc-user=turnserver
proc-group=turnserver
log-file=/dev/null